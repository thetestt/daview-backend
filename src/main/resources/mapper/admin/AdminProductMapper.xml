<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.daview.mapper.admin_mapper.AdminProductMapper">

  <!-- ✅ 상품 목록 조회 (검색 + 페이징 + 유형 JOIN) -->
  <select id="findAll" parameterType="com.daview.dto.admin_dto.AdminProductDTO"
          resultType="com.daview.dto.admin_dto.AdminProductDTO">
    SELECT 
      p.*, 
      pt.prod_name AS prod_type_name
    FROM admin_product p
    LEFT JOIN prod_type pt ON p.prod_type = pt.prod_type
    WHERE p.is_deleted = 0
    <if test="search != null and search != ''">
      AND p.prod_name LIKE CONCAT('%', #{search}, '%')
    </if>
    LIMIT #{size} OFFSET #{page}
  </select>

  <!-- ✅ 상품 단건 조회 -->
  <select id="findById" parameterType="string"
          resultType="com.daview.dto.admin_dto.AdminProductDTO">
    SELECT 
      p.*, 
      pt.prod_name AS prod_type_name
    FROM admin_product p
    LEFT JOIN prod_type pt ON p.prod_type = pt.prod_type
    WHERE p.prod_id = #{prodId}
      AND p.is_deleted = 0
  </select>

  <!-- ✅ 상품 등록 -->
  <insert id="insert" parameterType="com.daview.dto.admin_dto.AdminProductDTO">
    INSERT INTO admin_product (
      prod_id, prod_name, prod_type, prod_price, prod_detail
    )
    VALUES (
      #{prodId}, #{prodName}, #{prodType}, #{prodPrice}, #{prodDetail}
    )
  </insert>

  <!-- ✅ 상품 수정 -->
  <update id="update" parameterType="com.daview.dto.admin_dto.AdminProductDTO">
    UPDATE admin_product
    SET 
      prod_name = #{prodName},
      prod_type = #{prodType},
      prod_price = #{prodPrice},
      prod_detail = #{prodDetail},
      updated_at = CURRENT_TIMESTAMP
    WHERE prod_id = #{prodId}
      AND is_deleted = 0
  </update>

  <!-- ✅ 상품 삭제 (Soft Delete) -->
  <update id="delete" parameterType="string">
    UPDATE admin_product
    SET is_deleted = 1
    WHERE prod_id = #{prodId}
  </update>

</mapper>
